<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lawn Mowing Booking</title>
    <style>
        /* fonts */
        .oswald {
            font-family: "Oswald", sans-serif;
            font-optical-sizing: auto;
            /* font-weight: 200 - 700 */
            font-style: normal;
        }

        .quattrocento_regular {
            font-family: "Quattrocento", serif;
            font-weight: 400;
            font-style: normal;
        }

        .quattrocento_bold {
            font-family: "Quattrocento", serif;
            font-weight: 700;
            font-style: normal;
        }

        body {
            background-color: #f0f4f8;
            padding-top: 4rem;
        }
        .menu {
            flex: 2;
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            width: 55%;
            margin: auto;
        }
        .services {
            margin-top: 1rem;
        }
        .service-item {
            margin: 0.75rem 0;
            padding: 1rem 3rem;
            background: #eef2f7;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        .service-item button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .service-item button:hover {
            background: #0056b3;
        }

        select {
            -webkit-appearance: none;  /* Safari/Chrome */
            -moz-appearance: none;     /* Firefox */
            appearance: none;          /* Standard */
            background: white url('data:image/svg+xml;utf8,<svg fill=\"black\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>') no-repeat right 1rem center;
            background-size: 1.5rem;
            padding: 1rem 1.5rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            width: 400px;
        }
        button {
            padding: 1rem;
            cursor: pointer;
            font-size: 1rem;
        }

        /* --- Modal (overlay + popup) --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            display: none;  /* toggled to flex when open */
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .modal {
            width: min(680px, 92vw);
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.35);
        }
        .modal__cover {
            width: 100%;
            height: 220px;
            object-fit: cover;
            display: block;
            background: #e9eef4;
        }
        .modal__body {
            padding: 1.25rem 1.5rem 1.5rem;
        }
        .modal__header {
            display: flex;
            align-items: start;
            justify-content: space-between;
            gap: 1rem;
        }
        .modal__title {
            margin: 0;
        }
        .modal__price {
            margin: 0.25rem 0 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
        }
        .modal__desc {
            color: #334155;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        .modal__meta {
            font-size: 0.95rem;
            color: #475569;
            margin-bottom: 1rem;
        }
        .modal__actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .btn--primary {
            background: #007bff;
            color: #fff;
        }
        .btn--primary:hover { background: #0056b3; }
        .btn--ghost {
            background: #eef2f7;
        }
        .modal__close {
            background: transparent;
            border: none;
            font-size: 1.75rem;
            line-height: 1;
            cursor: pointer;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="menu">
        <h2 class="oswald">Select a Service</h2>
        <select id="serviceMenu">
            <option value="lawn_mowing">Lawn Mowing</option>
            <option value="soft_house_washing">Soft House Washing</option>
            <option value="pressure_washing">Pressure Washing</option>
            <option value="garden_maintenance">Garden Subscription</option>
        </select>
        
        <h2 id="sizeLabel" class="oswald">Select Size</h2>
        <select id="sizeMenu"></select>

        <div class="services" id="servicesList"></div>
    </div>

    <!-- Service Details Modal -->
    <div id="detailsOverlay" class="modal-overlay" onclick="closeDetails(event)">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="detailsTitle" onclick="event.stopPropagation()">
            <img id="detailsCover" class="modal__cover" src="" alt="">
            <div class="modal__body">
                <div class="modal__header">
                    <div>
                    <h2 id="detailsTitle" class="modal__title"></h2>
                    <p id="detailsPrice" class="modal__price"></p>
                    <p id="detailsMeta" class="modal__meta"></p>
                    </div>
                    <button class="modal__close" aria-label="Close" onclick="closeDetails(event)">&times;</button>
                </div>
                <p id="detailsDesc" class="modal__desc"></p>
                <div class="modal__actions">
                    <button class="btn btn--ghost" onclick="closeDetails(event)">Close</button>
                    <button id="detailsAddBtn" class="btn btn--primary">Add</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ---------- Data: Prices & Sizes ---------- */
        const servicePrices = {
            lawn_mowing: {
                small: { normal_grass: 11, long_grass: 21, overgrown_grass: 31 },
                medium: { normal_grass: 41, long_grass: 51, overgrown_grass: 61 },
                large: { normal_grass: 71, long_grass: 81, overgrown_grass: 91 },
                xLarge: { normal_grass: 101, long_grass: 111, overgrown_grass: 121 },
            },
            soft_house_washing: {
                small: { single_storey: 12, double_storey: 22, triple_storey: 32 },
                medium: { single_storey: 42, double_storey: 52, triple_storey: 62 },
                large: { single_storey: 72, double_storey: 82, triple_storey: 92 },
                xLarge: { single_storey: 102, double_storey: 112, triple_storey: 122 },
            },
            pressure_washing: {
                small: { decks_and_driveway: 13, fences_and_walls: 23, patios_and_pavers: 33 },
                medium: { decks_and_driveway: 43, fences_and_walls: 53, patios_and_pavers: 63 },
                large: { decks_and_driveway: 73, fences_and_walls: 83, patios_and_pavers: 93 },
                xLarge: { decks_and_driveway: 103, fences_and_walls: 113, patios_and_pavers: 123 },
            },
            garden_maintenance: {
                onesize: { bronze_package: 14, silver_package: 24, gold_package: 34 },
            },
        };

        const serviceSizes = {
            lawn_mowing: {
                small: "Small (1 - 50 sqm)",
                medium: "Medium (51 - 125 sqm)",
                large: "Large (126 - 255 sqm)",
                xLarge: "Extra Large (256 - 350 sqm)",
            },
            soft_house_washing: {
                small: "Small (under 150 sqm)",
                medium: "Medium (151 - 225 sqm)",
                large: "Large (226 - 300 sqm)",
                xLarge: "Extra Large (301 - 400 sqm)",
            },
            pressure_washing: {
                small: "Small ***",
                medium: "Medium ***",
                large: "Large ***",
                xLarge: "Extra Large ***",
            },
            garden_maintenance: {
                onesize: "",
            },
        };

        /* ---------- Content: covers & blurbs (with per-condition support) ---------- */
        const serviceContent = {
            lawn_mowing: {
                label: "Lawn Mowing",
                cover: "/assets/booking_system_img/normal_grass.jpg",
                desc: "Professional lawn mowing with neat edging and clippings removal.",
                byCondition: {
                    normal_grass: {
                        cover: '/assets/booking_system_img/normal_grass.jpg',
                        desc: 'Grass length is manageable. Perfect for routine care.',
                    },
                    long_grass: {
                        cover: '/assets/booking_system_img/long_grass.jpg',
                        desc: 'Grass is longer than usual. Includes slower passes for a clean, even cut.',
                    },
                    overgrown_grass: {
                        cover: '/assets/booking_system_img/overgrown_grass.jpg',
                        desc: 'Heavily overgrown lawn. Includes multiple cuts if needed to restore shape.',
                    },
                },
            },
            soft_house_washing: {
                label: "Soft House Washing",
                cover: "/assets/booking_system_img/soft_housewash.jpg",
                desc: "Soft house washing to remove grime, algae, and dust - gentle on paint, tough on dirt.",
                byCondition: {
                    single: "Single-storey dwelling soft-wash of exterior walls and eaves.",
                    double: "Double-storey exterior soft-wash. Includes careful application and rinse.",
                    triple: "Large/multi-level exterior soft-wash for expansive homes.",
                },
            },
            pressure_washing: {
                label: "Pressure Washing",
                cover: "/assets/booking_system_img/decks_driveway.jpg",
                desc: "High-pressure clean for hard surfaces.",
                byCondition: {
                    decks_and_driveway: {
                        cover: '/assets/booking_system_img/decks_driveway.jpg',
                        desc: 'Lift grime and tire marks on decks and driveways.',
                    },
                    fences_and_walls: {
                        cover: '/assets/booking_system_img/fences_walls.jpg',
                        desc: 'Refresh fence lines and boundary walls.',
                    },
                    patios_and_pavers: {
                        cover: '/assets/booking_system_img/patios_pavers.jpg',
                        desc: 'Restore patios and pavers to a brighter finish.',
                    },
                },
            },
            garden_maintenance: {
                label: "Garden Subscription",
                cover: "/assets/booking_system_img/decks_driveway.jpg",
                desc: "Scheduled garden care to keep everything tidy.",
                byCondition: {
                    bronze_package: {
                        cover: '/assets/booking_system_img/decks_driveway.jpg',
                        desc: 'Bronze package: light tidy and maintenance.',
                    },
                    silver_package: {
                        cover: '/assets/booking_system_img/fences_walls.jpg',
                        desc: 'Silver package: regular tidy plus seasonal extras.',
                    },
                    gold_package: {
                        cover: '/assets/booking_system_img/patios_pavers.jpg',
                        desc: 'Gold package: comprehensive monthly service.',
                    },
                },
            },
        };

        /* ---------- Add-ons (always visible) ---------- */
        const addOnServices = {
            roof_treatment: {
                price: 551,
                label: "Roof Treatment",
                cover: "/assets/booking_system_img/roof_treatment.jpg",
                desc: "Moss/mould treatment to extend roof life and improve appearance. Low-pressure application; results develop over weeks."
            },
            gutter_cleaning: {
                price: 552,
                label: "Gutter Cleaning",
                cover: "/assets/booking_system_img/gutter_cleaning.jpg",
                desc: "Remove leaves, debris, and blockages. Helps prevent overflow, leaks, and water damage during heavy rain."
            }
        }


        /* ---------- Helpers ---------- */
        function getCoverFor(service, condition) {
            const meta = serviceContent[service] || {};
            const cond = meta.byCondition?.[condition] || {};
            return cond.cover || meta.cover;
        }

        function getDescFor(service, condition) {
            const meta = serviceContent[service] || {};
            const cond = meta.byCondition?.[condition] || {};
            return cond.desc || meta.desc || "High-quality service delivered by Elysion.";
        }

        function capitalize(str) {
            if (!str) return '';
            return str
                .split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }


        /* ---------- Modal wiring ---------- */
        const overlayEl = document.getElementById("detailsOverlay");
        const coverEl   = document.getElementById("detailsCover");
        const titleEl   = document.getElementById("detailsTitle");
        const priceEl   = document.getElementById("detailsPrice");
        const metaEl    = document.getElementById("detailsMeta");
        const descEl    = document.getElementById("detailsDesc");
        const addBtnEl  = document.getElementById("detailsAddBtn");

        // Keep last selection so "Add" in modal can call addToCart
        let lastDetailsPayload = null;

        function openDetails(service, size, condition, price) {
            const isAddon = !size && !condition;

            const prettyService =
                (serviceContent[service]?.label) ||
                (addOnServices[service]?.label) ||
                capitalize(service);

            // Use condition-specific content for main services; add-ons continue to use their own meta
            const cover = isAddon
                ? addOnServices[service]?.cover
                : getCoverFor(service, condition);

            const description = isAddon
                ? (addOnServices[service]?.desc || "High-quality service delivered by Elysion.")
                : getDescFor(service, condition);

            coverEl.src = cover;
            coverEl.alt = `${prettyService} cover`;
            titleEl.textContent = `${prettyService}`;
            priceEl.textContent = `From $${price}`;
            metaEl.textContent = isAddon
                ? "Add-on service"
                : `${(serviceSizes[service] && serviceSizes[service][size])
                    ? serviceSizes[service][size]
                    : capitalize(size)}${condition ? " • " + capitalize(condition) : ""}`;
            descEl.textContent = description;

            lastDetailsPayload = { service: prettyService, size, condition, price };

            addBtnEl.onclick = function() {
                if (isAddon) {
                    addToCart(`Add-on: ${prettyService}`, "", "", price);
                } else {
                    addToCart(service, size, condition, price);
                }
                closeDetails();
            };

            overlayEl.style.display = "flex";
            document.body.style.overflow = "hidden";
        }

        function closeDetails(e) {
            overlayEl.style.display = "none";
            document.body.style.overflow = "";
        }


        /* ---------- UI renderers ---------- */
        let cart = [];

        function populateSizeMenu(service) {
            const sizeMenu = document.getElementById("sizeMenu");
            const sizes = serviceSizes[service];
            sizeMenu.innerHTML = "";

            if (!sizes) return;

            for (const size in sizes) {
                const option = document.createElement("option");
                option.value = size;
                option.textContent = sizes[size];
                sizeMenu.appendChild(option);
            }
        };

        function renderServices(service, size) {
            const container = document.getElementById("servicesList");
            container.innerHTML = "";

            const options = Object.keys(servicePrices[service][size]);

            options.forEach(condition => {
                const price = servicePrices[service][size][condition];
                const div = document.createElement("div");
                div.className = "service-item";
                div.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 3rem;">
                        <img src="${getCoverFor(service, condition)}" alt="${service} ${condition} cover" 
                            style="width: 120px; height: 100px; object-fit: cover; border-radius: 6px;">
                        <div>
                            <h3 class='quattrocento_regular'>${capitalize(condition)}</h3>
                            <h2 class='oswald'>From $${price}</h2>
                        </div>
                    </div>
                    <div>
                        <button class="quattrocento_bold"
                            onclick="openDetails('${service}', '${size}', '${condition}', ${price})">
                            View Details
                        </button>
                        <button class="quattrocento_bold"
                            onclick="addToCart('${service}', '${size}', '${condition}', ${price})">
                            Add
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });

            // Add-ons header
            const header = document.createElement("h3");
            header.className = 'oswald'
            header.style.marginTop = "1.25rem";
            header.textContent = "Add-ons";
            container.appendChild(header);

            // Add-ons list (always visible)
            Object.keys(addOnServices).forEach(key => {
                const { price, label, cover, desc } = addOnServices[key];
                const div = document.createElement("div");
                div.className = "service-item";
                div.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 3rem;">
                        <img src="${cover}" alt="${label} cover"
                            style="width: 120px; height: 100px; object-fit: cover; border-radius: 6px;">
                        <div>
                            <h3 class='quattrocento_regular'>${label}</h3>
                            <h2 class='oswald'>From $${price}</h2>
                        </div>
                    </div>
                    <div>
                        <button class="quattrocento_bold"
                            onclick="openDetails('${key}', '', '', ${price})">
                            View Details
                        </button>
                        <button class="quattrocento_bold"
                            onclick="addToCart('Add-on: ${label}', '', '', ${price})">
                            Add
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }


        /* ---------- Cart bridge to parent ---------- */
        function addToCart(service, size, condition, price) {
            window.parent.postMessage({
                type: "ADD_TO_CART",
                service: capitalize(service),
                size: capitalize(size),
                condition: capitalize(condition),
                price
            }, "*");
        };


        /* ---------- Event wiring & initial render ---------- */
        document.getElementById("serviceMenu").addEventListener("change", function() {
            const service = this.value;
            populateSizeMenu(service);
            const size = document.getElementById("sizeMenu").value;
            renderServices(service, size);
        });

        document.getElementById("sizeMenu").addEventListener("change", function() {
            const service = document.getElementById("serviceMenu").value;
            renderServices(service, this.value);
        });

        // Initial render
        populateSizeMenu("lawn_mowing");
        renderServices("lawn_mowing", "small");
    </script>
</body>
</html>
